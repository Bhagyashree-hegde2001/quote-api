(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k;y=[],u=null,d=!1,k=function(e){return t?(n(),w(e),c(e)):document.location.href=e},c=function(e){var t;return C("page:fetch"),t=new XMLHttpRequest,t.open("GET",e,!0),t.setRequestHeader("Accept","text/html, application/xhtml+xml, application/xml"),t.onload=function(){return r.apply(null,f(t.responseText)),C("page:load")},t.onabort=function(){return console.log("Aborted turbolink fetch!")},t.send()},l=function(e){var t;return n(),(t=y[e.position])?(r(t.title,t.body.cloneNode(!0)),b(t),C("page:restore")):c(document.location.href)},n=function(){return x(),y[u.position]={url:document.location.href,body:document.body,title:document.title,positionY:window.pageYOffset,positionX:window.pageXOffset},i(10)},i=function(e){if(u.position===window.history.length-1)return delete y[u.position-e]},r=function(e,t){return document.title=e,document.documentElement.replaceChild(t,document.body),u=window.history.state,C("page:change")},w=function(e){if(e!==document.location.href)return window.history.pushState({turbolinks:!0,position:u.position+1},"",e)},S=function(){return window.history.replaceState({turbolinks:!0,position:window.history.length-1},"",document.location.href)},E=function(){return u=window.history.state},x=function(){if(!d)return S(),E(),d=!0},b=function(e){return window.scrollTo(e.positionX,e.positionY)},C=function(e){var t;return t=document.createEvent("Events"),t.initEvent(e,!0,!0),document.dispatchEvent(t)},f=function(e){var t,n;return t=s(e),n=t.querySelector("title"),[n!=null?n.textContent:void 0,t.body]},s=function(){var e,t,n,r;return e=function(e){return(new DOMParser).parseFromString(e,"text/html")},t=function(e){var t;return t=document.implementation.createHTMLDocument(""),t.open("replace"),t.write(e),t.close,t},window.DOMParser&&(n=e("<html><body><p>test")),(n!=null?(r=n.body)!=null?r.childNodes.length:void 0:void 0)===1?e:t}(),h=function(e){var t;t=a(e);if(t.nodeName==="A"&&!p(e,t))return k(t.href),e.preventDefault()},a=function(e){var t;t=e.target;while(t!==document&&t.nodeName!=="A")t=t.parentNode;return t},N=function(e){return e.href===document.location.href},o=function(e){return location.protocol!==e.protocol||location.host!==e.host},e=function(e){return(e.hash&&e.href.replace(e.hash,""))===location.href.replace(location.hash,"")||e.href===location.href+"#"},g=function(e){return e.href.match(/\.[a-z]+(\?.*)?$/g)&&!e.href.match(/\.html?(\?.*)?$/g)},T=function(e){return e.getAttribute("data-remote")!=null},m=function(e){return e.getAttribute("data-no-turbolink")!=null},v=function(e){return e.which>1||e.metaKey||e.ctrlKey},p=function(t,n){return N(n)||o(n)||e(n)||g(n)||T(n)||m(n)||v(t)},t=window.history&&window.history.pushState&&window.history.replaceState,t&&(window.addEventListener("popstate",function(e){var t;if((t=e.state)!=null?t.turbolinks:void 0)return l(e.state)}),document.addEventListener("click",function(e){return h(e)})),this.Turbolinks={visit:k}}).call(this),(typeof window.localStorage=="undefined"||typeof window.sessionStorage=="undefined")&&function(){var e=function(e){function t(e,t,n){var r,i;n?(r=new Date,r.setTime(r.getTime()+n*24*60*60*1e3),i="; expires="+r.toGMTString()):i="",document.cookie=e+"="+t+i+"; path=/"}function n(e){var t=e+"=",n=document.cookie.split(";"),r,i;for(r=0;r<n.length;r++){i=n[r];while(i.charAt(0)==" ")i=i.substring(1,i.length);if(i.indexOf(t)==0)return i.substring(t.length,i.length)}return null}function r(n){n=JSON.stringify(n),e=="session"?window.name=n:t("localStorage",n,365)}function i(){e=="session"?window.name="":t("localStorage","",365)}function s(){var t=e=="session"?window.name:n("localStorage");return t?JSON.parse(t):{}}var o=s();return{length:0,clear:function(){o={},this.length=0,i()},getItem:function(e){return o[e]===undefined?null:o[e]},key:function(e){var t=0;for(var n in o){if(t==e)return n;t++}return null},removeItem:function(e){delete o[e],this.length--,r(o)},setItem:function(e,t){o[e]=t+"",this.length++,r(o)}}};typeof window.localStorage=="undefined"&&(window.localStorage=new e("local")),typeof window.sessionStorage=="undefined"&&(window.sessionStorage=new e("session"))}(),function(){var e,t;t=function(e){return $(e).text("You love this").removeClass("unliked").addClass("liked").removeAttr("data-vote").click(function(e){return e.preventDefault,!1})},e=function(){return console.log("on load"),$("a.vote").each(function(e,n){if(localStorage.getItem("quote-"+$(n).data("quote")))return t(n)}),$("[data-vote]").click(function(e){var n;return e.preventDefault,n=$(this),$(n).text("Voting..."),$.post($(this).data("vote"),{},function(){return localStorage.setItem("quote-"+$(n).data("quote"),1),_gaq.push(["_trackEvent","Likes","Like",$(n).data("quote")]),t(n)}),!1})},$(function(){return e()}),$(window).bind("page:change",e)}.call(this);